<html>

<head>
    <meta charset="utf-8">
    <link rel="icon" type="image/webp" href="../replaylogo.webp"/>
    <link rel="stylesheet" href="../css/echo_styles.css">
    <style>


        #instructions_box {
            width: auto;
        }

        #instructions_box img {
            max-width: 100%;
        }


    </style>
    <meta name="viewport" content="width=device-width; initial-scale=1.0">
    <title>Replay Viewer Keys</title>
</head>

<body style="
    background-image: url(../echovr_background_4k.webp);
    background-size:100%;
    background-color: #0b0d1c;
    font-family: Arial, Helvetica, sans-serif;
">

    <div class="header_with_background">
        <div></div>
        <h1>Replay Viewer Oculus Store Keys</h1>
    </div>

    <div class="echo_alert_box">
        Enter Oculus Username: <input type="text" id='username_field' data-lpignore="true">
    </div>

    <a style="width:18em; margin: auto;display: block;text-decoration: none;" href="javascript: GETKEYPLZ()">
        <div class="echobutton">GET KEY</div>
    </a>

    <div id="error_message" class="echo_alert_box" style="display:none;"></div>
    <div id="key_success_box" style="display:none;">
        <div class="echo_alert_box">
            <div id="key"></div>
        </div>
        <div class="echo_alert_box" id="instructions_box">
            How to use the code:
            <br>
            If the key is already used, just click GET KEY again and try a new one.
            <br>
            <br>
            <img src="redeem_code.webp">
        </div>
    </div>


    <script type="text/javascript">
        function GETKEYPLZ() {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                    HandleJSONResponse(xmlHttp.responseText);
            }
            var username = document.getElementById("username_field").value;
            xmlHttp.open("GET", "https://ignitevr.gg/cgi-bin/EchoStats.cgi/get_replay_viewer_key?username=" + username, true); // true for asynchronous 
            xmlHttp.send(null);
        }
        function HandleJSONResponse(resp) {
            r = JSON.parse(resp)
            if (r.success) {
                document.getElementById('key_success_box').style.display = "block";
                document.getElementById('error_message').style.display = "none";
                document.getElementById('key').innerText = r.key;
            } else {
                document.getElementById('error_message').style.display = "block";
                document.getElementById('key_success_box').style.display = "none";
                document.getElementById('error_message').innerText = "Error: " + r.error;
            }
        }
    </script>
</body>

</html>
